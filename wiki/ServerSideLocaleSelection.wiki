#summary API to support locale selection on the server.
#labels Phase-Deploy,Type-Library

= Introduction =

For internationalized GWT applications, ideally the server would select the default locale based on the user's language preference settings in his/her browser.  These are normally supplied as part of the HTTP request in the Accept-Language header (many users do not have this configured correctly, so you still need to provide a way for the user to change the locale).  Aside from the contents of the Accept-Language header, you also need a list of the locales which the application was compiled with.

This document describes `LocaleListLinker`, which generates a text file containing the compiled locales, and `LocaleMatcher`, which chooses an available locale which best matches the user's preferences.


= Details =

== `LocaleListLinker` ==

This class is a Linker which produces a text file containing all the locales which were compiled into your GWT app.  It is used as follows in your .gwt.xml file:
{{{
  <define-linker name="localeList" class="com.google.gwt.libideas.linker.LocaleListLinker"/>
  <set-linker name="std,localeList"/>
}}}
(note that you should set the linkers to include whatever other linkers you want)

After compile, the output will be in `www/modulename/localeList/locale-list.txt` -- your deployment process should then include this file in a way that it can be accessed by the deployed server code.  

== `LocaleMatcher` ==

This class is used to select the proper locale for a given request.  It is initialized with an `InputStream` containing the `locale-list.txt` file generated by the above linker (or other means).  Sample usage:
{{{
  // Setup code
  Resource resource = Resource.newResource("my_deployed_app_path/localeList/locale-list.txt");
  LocaleMatcher localeMatcher = new LocaleMatcher(resource.getInputStream());

  // Per-request code for the host html page
  String locale = localeMatcher.findBestMatch(request.getHeader("Accept-language"));
  // Store the selected locale in the host html page to be served, via
  // <meta name='gwt:property' content='locale=<<locale>>'>
  // Be sure to include a Vary: Accept-language header in the response header.
 }}}
